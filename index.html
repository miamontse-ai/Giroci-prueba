<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GirOci - Master Blindado</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body {
            background: linear-gradient(180deg, #38b6ff 0%, #43e97b 100%);
            min-height: 100vh;
            font-family: 'ui-sans-serif', system-ui, -apple-system, sans-serif;
            margin: 0;
            overflow-x: hidden; 
        }
        
        #splash-screen {
            position: fixed; inset: 0; width: 100vw; height: 100vh;
            display: flex; flex-direction: column;
            align-items: center; justify-content: space-around;
            z-index: 8000; background: linear-gradient(180deg, #38b6ff 0%, #43e97b 100%);
            transition: all 0.6s ease; padding: 2rem 0;
        }
        .logo-splash { width: 85%; max-width: 450px; filter: drop-shadow(0 20px 40px rgba(0,0,0,0.3)); }
        .btn-entrar { background: white; color: #1e5d8a; padding: 20px 70px; border-radius: 50px; font-weight: 900; font-size: 1.5rem; box-shadow: 0 10px 30px rgba(0,0,0,0.25); cursor: pointer; border: none; }

        #main-content { display: none; opacity: 0; transition: opacity 0.8s ease; padding: 20px; max-width: 500px; margin: 0 auto; }
        
        .custom-select { position: relative; user-select: none; }
        .select-trigger { background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.4); border-radius: 12px; padding: 8px 12px; color: white; display: flex; align-items: center; justify-content: space-between; font-weight: bold; font-size: 13px; cursor: pointer; }
        
        .options-menu { 
            position: absolute; top: 115%; right: 0; 
            background: linear-gradient(180deg, rgba(255,255,255,0.7) 0%, rgba(255,255,255,0.4) 100%); 
            backdrop-filter: blur(15px); border-radius: 24px; 
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); 
            width: 220px; display: none; z-index: 9000; 
            overflow-y: auto; max-height: 380px; padding: 8px 0;
        }
        .options-menu.show { display: block; }
        .option-item { padding: 12px 20px; display: flex; align-items: center; gap: 15px; color: #1e293b; font-size: 15px; cursor: pointer; font-weight: 800; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }

        .flag-icon { width: 22px; height: 15px; object-fit: cover; }
        #loading-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 9999; color: white; flex-direction: column; gap: 10px; }
    </style>
</head>
<body>

    <div id="loading-overlay"><i class="fas fa-circle-notch fa-spin text-4xl"></i><p>Carregant dades...</p></div>

    <div id="splash-screen">
        <img src="logo.png" alt="GirOci Logo" class="logo-splash">
        <button class="btn-entrar" onclick="entrarApp()">ENTRAR</button>
    </div>

    <div id="main-content">
        <div class="flex justify-end mb-4">
            <div class="custom-select w-[110px]">
                <div class="select-trigger" onclick="toggleMenu('langMenu')">
                    <span id="selected-lang-content" class="flex items-center gap-2"><img src="bandera_ca.png" class="flag-icon"> CAT</span>
                    <i class="fas fa-chevron-down text-[10px]"></i>
                </div>
                <div class="options-menu !w-[130px]" id="langMenu">
                    <div class="option-item" onclick="selectLang('ca', 'bandera_ca.png', 'CAT')"><img src="bandera_ca.png" class="flag-icon"> CAT</div>
                    <div class="option-item" onclick="selectLang('es', 'bandera_es.png', 'ESP')"><img src="bandera_es.png" class="flag-icon"> ESP</div>
                    <div class="option-item" onclick="selectLang('en', 'bandera_en.png', 'ENG')"><img src="bandera_en.png" class="flag-icon"> ENG</div>
                </div>
            </div>
        </div>

        <div class="flex items-center justify-center gap-4 mb-8">
            <img src="logo.png" alt="Logo" class="w-24 h-24 object-contain">
            <h1 class="text-6xl text-white font-black tracking-tighter">GirOci</h1>
        </div>

        <div class="flex gap-2 mb-8">
            <div class="custom-select flex-1">
                <div class="bg-[#1e5d8a] select-trigger !py-4 !rounded-2xl" onclick="toggleMenu('typeMenu')">
                    <span id="txt-filter-type">Tipus d'Oci</span><i class="fas fa-chevron-down"></i>
                </div>
                <div class="options-menu !w-full" id="typeMenu" style="left:0;"></div>
            </div>
            <div class="custom-select flex-1">
                <div class="bg-[#1e5d8a] select-trigger !py-4 !rounded-2xl" onclick="toggleMenu('comarcaMenu')">
                    <span id="txt-filter-comarca">Comarca</span><i class="fas fa-chevron-down"></i>
                </div>
                <div class="options-menu !w-full" id="comarcaMenu" style="left:0;"></div>
            </div>
        </div>

        <h2 id="txt-events-title" class="text-white text-2xl font-bold mb-5 ml-1">Esdeveniments Propers</h2>
        <div id="events-grid" class="grid grid-cols-2 gap-4 mb-10"></div>
    </div>

    <div id="pantalla-detalle" class="fixed inset-0 bg-[#1e293b] z-[7000] hidden overflow-y-auto">
        <div class="relative w-full h-[35vh] bg-black">
            <img id="img-det" src="" class="w-full h-full object-contain">
            <button onclick="cerrarDetalle()" class="absolute top-6 left-5 bg-black/40 p-3 rounded-full text-white"><i class="fas fa-arrow-left"></i></button>
        </div>
        <div class="p-6">
            <h2 id="titulo-det" class="text-3xl font-black text-white mb-4"></h2>
            <div class="grid grid-cols-2 gap-3 mb-6">
                <div class="bg-slate-800 p-3 rounded-xl"><p class="text-[10px] text-gray-400 uppercase">Lloc</p><p id="lugar-det" class="text-cyan-400 font-bold"></p></div>
                <div class="bg-slate-800 p-3 rounded-xl"><p class="text-[10px] text-gray-400 uppercase">Data</p><p id="fecha-det" class="text-purple-400 font-bold"></p></div>
            </div>
            <p id="desc-det" class="text-slate-300 mb-8"></p>
            <div class="flex gap-3">
                <button onclick="abrirMapa()" class="flex-1 bg-slate-700 text-white py-4 rounded-xl font-bold">Mapa</button>
                <button id="btn-reserve" onclick="irAReserva()" class="flex-1 bg-cyan-500 text-white py-4 rounded-xl font-bold hidden">Reservar</button>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwxJoxAGAkRVvGlTQ5OQBrWc_aq15uCXjH14y5G0CmtIx_NJgCAJlUM9eeiGwFOgXBx/exec";
        let currentLang = 'ca', currentCategory = 'all', currentComarca = 'all', eventData = [], currentTicketUrl = "";

        const translations = {
            ca: { filterType: "Tipus d'Oci", comarca: "Comarca", title: "Esdeveniments Propers", all: "Tots" },
            es: { filterType: "Tipo de Ocio", comarca: "Comarca", title: "Próximos Eventos", all: "Todos" },
            en: { filterType: "Leisure Type", comarca: "County", title: "Upcoming Events", all: "All" }
        };

        const categoryNames = {
            conciertos: { icon: "fa-music", ca: "Concerts", es: "Conciertos", en: "Concerts" },
            actividades: { icon: "fa-palette", ca: "Activitats", es: "Actividades", en: "Activities" }
        };

        async function loadData() {
            document.getElementById('loading-overlay').style.display = 'flex';
            try {
                const response = await fetch(SCRIPT_URL);
                eventData = await response.json();
                renderEvents(); renderCategories();
            } catch (e) { console.error(e); }
            document.getElementById('loading-overlay').style.display = 'none';
        }

        function renderEvents() {
            const grid = document.getElementById('events-grid');
            let filtered = eventData.filter(ev => {
                const matchCat = currentCategory === 'all' || ev.Categoria.toLowerCase() === currentCategory.toLowerCase();
                const matchCom = currentComarca === 'all' || ev.Comarca === currentComarca;
                return matchCat && matchCom;
            });
            grid.innerHTML = filtered.map(ev => `
                <div onclick="abrirDetalle('${ev.ID}')" class="bg-white rounded-2xl overflow-hidden shadow-lg cursor-pointer">
                    <img src="${ev.Imagen_URL}" class="h-32 w-full object-cover">
                    <div class="p-3">
                        <h3 class="font-bold text-xs h-8 overflow-hidden">${ev['Titulo_'+currentLang.toUpperCase()] || ev.Titulo_CA}</h3>
                        <p class="text-[10px] text-gray-500 mt-1 uppercase">${ev.Municipio}</p>
                    </div>
                </div>`).join('');
        }

        function abrirDetalle(id) {
            const ev = eventData.find(e => String(e.ID) === String(id));
            if(!ev) return;
            const lang = currentLang.toUpperCase();
            document.getElementById('titulo-det').innerText = ev['Titulo_'+lang] || ev.Titulo_CA;
            document.getElementById('lugar-det').innerText = ev.Municipio;
            document.getElementById('fecha-det').innerText = ev.Fecha ? ev.Fecha.split('T')[0] : "";
            document.getElementById('desc-det').innerText = ev['Desc_'+lang] || ev.Desc_CA;
            document.getElementById('img-det').src = ev.Imagen_URL;
            currentTicketUrl = ev.Link_Entradas;
            document.getElementById('btn-reserve').classList.toggle('hidden', !(currentTicketUrl && currentTicketUrl.length > 5));
            document.getElementById('pantalla-detalle').classList.remove('hidden');
        }

        function toggleMenu(id) { 
            const m = document.getElementById(id);
            document.querySelectorAll('.options-menu').forEach(x => x !== m && x.classList.remove('show'));
            m.classList.toggle('show');
        }

        function cerrarDetalle() { document.getElementById('pantalla-detalle').classList.add('hidden'); }
        function irAReserva() { if(currentTicketUrl) window.open(currentTicketUrl, '_blank'); }
        function abrirMapa() { /* Lógica de mapa */ }
        function entrarApp() { 
            document.getElementById('splash-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('splash-screen').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                setTimeout(() => document.getElementById('main-content').style.opacity = '1', 50);
                loadData();
            }, 600);
        }
    </script>
</body>
</html>
