<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GirOci - Master 1.5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background: linear-gradient(180deg, #38b6ff 0%, #43e97b 100%); min-height: 100vh; font-family: sans-serif; margin: 0; }
        #splash-screen { position: fixed; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: space-around; z-index: 9999; background: linear-gradient(180deg, #38b6ff 0%, #43e97b 100%); transition: opacity 0.4s; }
        .logo-splash { width: 90%; max-width: 500px; filter: drop-shadow(0 20px 30px rgba(0,0,0,0.3)); }
        .btn-entrar { background: white; color: #1e5d8a; padding: 20px 80px; border-radius: 60px; font-weight: 900; font-size: 1.5rem; cursor: pointer; border: none; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        #main-content { display: none; opacity: 0; max-width: 500px; margin: 0 auto; padding: 20px; transition: opacity 0.5s; }
    </style>
</head>
<body>

    <div id="splash-screen">
        <img src="logo.png" class="logo-splash">
        <button class="btn-entrar" onclick="entrarApp()">ENTRAR</button>
    </div>

    <div id="main-content">
        <div class="flex items-center justify-center gap-2 mb-8">
            <img src="logo.png" class="w-16 h-16">
            <h1 class="text-4xl text-white font-black">GirOci</h1>
        </div>

        <div class="space-y-4 mb-8">
            <button onclick="activarSeccionCine()" class="w-full bg-blue-700 text-white py-5 rounded-2xl font-black text-xl shadow-lg flex items-center justify-center gap-3">
                <i class="fas fa-film"></i> CARTELLERA DE CINE
            </button>
        </div>

        <h2 id="txt-seccion" class="text-white text-xl font-black mb-4 uppercase">Esdeveniments</h2>
        <div id="grid-principal" class="grid grid-cols-2 gap-4 pb-20"></div>
    </div>

    <div id="pantalla-cine" class="fixed inset-0 bg-slate-900 z-[100] hidden overflow-y-auto p-6">
        <button onclick="cerrarCine()" class="text-white font-bold mb-6 flex items-center gap-2">
            <i class="fas fa-arrow-left"></i> TORNAR
        </button>
        <h2 id="nombre-cine-header" class="text-cyan-400 font-black text-2xl mb-6 uppercase"></h2>
        <div id="grid-peliculas" class="grid grid-cols-2 gap-4"></div>
    </div>

    <script>
        var eventData = [], cineData = [];

        function entrarApp() {
            document.getElementById('splash-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('splash-screen').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                setTimeout(() => document.getElementById('main-content').style.opacity = '1', 50);
                cargarArchivos();
            }, 400);
        }

        async function cargarArchivos() {
            try {
                // CARGA EVENTOS
                const resEv = await fetch("eventos.json?v=" + Date.now());
                eventData = await resEv.json();
                renderEvents();

                // CARGA CINE (csvjson (2).json)
                const resCi = await fetch("cine.json?v=" + Date.now());
                const rawCine = await resCi.json();
                
                // BLINDAJE: Filtramos para que SOLO cargue filas que tengan un TÍTULO real
                cineData = rawCine.filter(item => item.TITULO && item.TITULO.length > 2);
                
                console.log("Cine cargado correctamente:", cineData.length, "películas.");
            } catch (e) {
                console.error("Error cargando los datos. Revisa que los nombres de archivo sean correctos.");
            }
        }

        function renderEvents() {
            const grid = document.getElementById('grid-principal');
            grid.innerHTML = eventData.map(ev => `
                <div class="bg-white rounded-xl overflow-hidden shadow-md">
                    <img src="${ev.Imagen_URL}" class="w-full h-32 object-cover">
                    <div class="p-2"><p class="font-bold text-[10px] leading-tight text-gray-800">${ev.Titulo_CA || ev.Titulo_ES}</p></div>
                </div>
            `).join('');
        }

        function activarSeccionCine() {
            document.getElementById('txt-seccion').innerText = "Cines Disponibles";
            const grid = document.getElementById('grid-principal');
            const listaCines = ["Ocine Girona", "Odeon Girona", "Ocine Blanes", "Ocine Platja d'Aro", "Multicines Olot", "Cat Cinemes"];
            
            grid.innerHTML = listaCines.map(cine => `
                <div onclick="abrirCartellera('${cine}')" class="col-span-2 bg-white/10 p-5 rounded-xl text-white font-bold border border-white/20 flex justify-between items-center active:bg-white/20">
                    ${cine} <i class="fas fa-chevron-right opacity-30"></i>
                </div>
            `).join('');
        }

        function abrirCartellera(cineNombre) {
            document.getElementById('nombre-cine-header').innerText = cineNombre;
            const pelis = cineData.filter(p => p.CINE === cineNombre);
            const grid = document.getElementById('grid-peliculas');
            
            if(pelis.length === 0) {
                grid.innerHTML = '<p class="text-white/50 col-span-2 text-center py-10">No hi ha dades actualitzades per aquest cinema.</p>';
            } else {
                grid.innerHTML = pelis.map(p => `
                    <div class="bg-white/5 p-2 rounded-xl text-center shadow-lg">
                        <img src="${p.IMAGEN_URL}" class="w-full rounded-lg mb-2 border border-white/10">
                        <p class="text-white text-[10px] font-bold leading-tight">${p.TITULO}</p>
                    </div>
                `).join('');
            }
            document.getElementById('pantalla-cine').classList.remove('hidden');
        }

        function cerrarCine() {
            document.getElementById('pantalla-cine').classList.add('hidden');
        }
    </script>
</body>
</html>
